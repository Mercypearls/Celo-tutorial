# Implementing Celo Blockchain Oracles for External Data Integration

## Introduction

In this tutorial, we will explore how to leverage Celo blockchain oracles to integrate external data into smart contracts and DApps. The ability to access off-chain data is crucial for real-world use cases, and decentralized oracles provide a reliable and secure way to fetch and verify this data within the Celo ecosystem.

We will be using Hardhat, a popular development environment for Ethereum and Celo, to build our project. Hardhat provides a robust framework and toolset for smart contract development, testing, and deployment.

## Prerequisites

Before we begin, make sure you have the following:

1. Basic knowledge of Solidity and smart contract development.
2. Node.js installed on your machine.
3. Familiarity with Hardhat. If you're new to Hardhat, you can refer to the [Hardhat documentation](https://hardhat.org/getting-started/) for installation and setup instructions.

# Overview of Celo Oracles

## What are Celo Oracles?

Celo oracles are specialized components that enable smart contracts to interact with external data. They act as bridges between the blockchain and off-chain data sources, fetching and verifying data to make it available within the Celo ecosystem.


## Why are Oracles Important?

Oracles play a crucial role in expanding the functionality and use cases of smart contracts. By providing access to external data, oracles enable smart contracts to interact with the real world and make decisions based on real-time information.

For example, in a decentralized finance (DeFi) application, an oracle can provide the current price of an asset. Smart contracts can then use this price to execute trades, calculate interest rates, or trigger other actions.

## Benefits and Challenges of Using Decentralized Oracles

Decentralized oracles offer several benefits compared to centralized alternatives:

- **Increased Security**: Decentralized oracles distribute the data-fetching and verification process across multiple nodes, making it more resistant to single points of failure and manipulation.

- **Transparency**: The operations performed by decentralized oracles are transparent and auditable on the blockchain, providing increased trust in the integrity of the data.

- **Trustless Data Feeds**: Decentralized oracles enable trustless data feeds, reducing the reliance on centralized entities for providing external data.

However, implementing decentralized oracles comes with challenges, such as ensuring data integrity, managing consensus mechanisms, and designing appropriate trust models.

## Setting up the Project

Let's start by setting up a new Hardhat project.

1. Create a new directory for your project:

   ```bash
   mkdir celo-oracles-tutorial
   cd celo-oracles-tutorial


2. Initialize a new Hardhat project:

```
npx hardhat init
```
3. Install the required dependencies:

```
npm install @celo/contractkit dotenv
```

4. Create a new file named .env in the root directory of your project and add the following content:

```
MNEMONIC=<your-mnemonic-phrase>
```
Replace <your-mnemonic-phrase> with the mnemonic phrase of your Celo account. Make sure the account has some testnet CELO tokens for testing purposes.

## Configuring Hardhat
 Next, let's configure Hardhat to work with the Celo network and enable the required plugins.

1. Open the `hardhat.config.js` file generated by the  `npx hardhat init` command.

2. Replace the contents of the file with the following code:

```
  require('dotenv').config();
const { CeloNetwork } = require("@celo-tools/use-contractkit");

module.exports = {
  defaultNetwork: 'hardhat',
  networks: {
    hardhat: {},
    alfajores: {
      url: 'https://alfajores-forno.celo-testnet.org',
      accounts: { mnemonic: process.env.MNEMONIC },
      chainId: CeloNetwork.Alfajores
    },
    mainnet: {
      url: 'https://forno.celo.org',
      accounts: { mnemonic: process.env.MNEMONIC },
      chainId: CeloNetwork.Mainnet
    },
  },
  solidity: {
    version: '0.8.7',
    settings: {
      optimizer: {
        enabled: true,
        runs: 200,
      },
    },
  },
  paths: {
    sources: './contracts',
    tests: './test',
    cache: './cache',
    artifacts: './artifacts',
  },
  mocha: {
    timeout: 20000,
  },
};
```

This configuration sets up the networks for the Celo Alfajores testnet and the Celo mainnet. It also includes the necessary plugins and specifies the Solidity compiler version.

## Creating the Oracle Contract
Now, let's create a new Solidity contract that utilizes Celo oracles to fetch and store external data.

1. Create a new file named Oracle.sol in the contracts directory.

2. Add the following code to define the Oracle contract:

 ```
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import { UsingTellor } from "@celo/contractkit/contracts/identity/UsingTellor.sol";

contract Oracle is UsingTellor {
    uint256 public data;
    uint256 public requestId;

    event ExternalDataUpdated(uint256 newValue);

    constructor(address _tellor) UsingTellor(_tellor) {
        requestId = 1; // Specify the request ID for the desired data
    }

    /**
     * @dev Updates the external data by fetching the value from the Tellor oracle.
     * This function can be called by anyone.
     * Emits an `ExternalDataUpdated` event with the new value.
     * Reverts if the data is not yet ready or if there is an error fetching the data.
     */
    function updateExternalData() public {
        require(isDataReady(), "Data is not yet ready");
        (bool success, int256 value, ) = getCurrentValue(requestId);
        require(success && value > 0, "Error fetching external data");

        data = uint256(value);
        emit ExternalDataUpdated(data);
    }

    /**
     * @dev Checks if the data is ready to be fetched from the Tellor oracle.
     * Returns true if the request timestamp is greater than 0 and less than or equal to the current block timestamp.
     * Otherwise, returns false.
     */
    function isDataReady() public view returns (bool) {
        uint256 requestTimestamp = getRequestTimestamp(requestId);
        return requestTimestamp > 0 && requestTimestamp <= block.timestamp;
    }
}
 ```
In this contract, we define the data variable to store the fetched external data. The updateExternalData function is used to trigger the data retrieval process, and the isDataReady function checks if the data is ready for retrieval.

## Writing Tests
Let's write some tests to ensure our contract functions as expected.

1. Create a new file named oracle.test.js in the test directory.

2. Add the following code to define the tests:

```
const { expect } = require('chai');
const { ethers } = require('hardhat');

describe('Oracle', function () {
  let oracle;

  beforeEach(async function () {
    const Oracle = await ethers.getContractFactory('Oracle');
    oracle = await Oracle.deploy('<tellor-contract-address>');
    await oracle.deployed();
  });

  it('should fetch external data', async function () {
    await oracle.updateExternalData();
    const data = await oracle.data();
    expect(data).to.equal(0); // Replace 0 with the expected fetched data value
  });
});
```
In this test, we deploy the Oracle contract and verify that the updateExternalData function correctly updates the data variable. Adjust the expected data value according to your use case.

## Compiling and Running Tests

1. Compile the contracts and run the tests using Hardhat:

```
npx hardhat compile
npx hardhat test
```
If everything is set up correctly, you should see the test passing.

## Conclusion
Congratulations! You have learned how to implement Celo blockchain oracles for external data integration in your smart contracts and DApps. By leveraging Celo oracles, you can securely access off-chain data and enhance the functionality of your decentralized applications.

Remember to refer to the official Celo documentation and community resources to stay updated with the latest features and best practices.
   

