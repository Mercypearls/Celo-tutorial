# Implementing Celo Blockchain Oracles for External Data Integration

## Introduction

In this tutorial, we will explore how to leverage Celo blockchain oracles to integrate external data into smart contracts and DApps. The ability to access off-chain data is crucial for real-world use cases, and decentralized oracles provide a reliable and secure way to fetch and verify this data within the Celo ecosystem.

We will be using Hardhat, a popular development environment for Ethereum and Celo, to build our project. Hardhat provides a robust framework and toolset for smart contract development, testing, and deployment.

## Prerequisites

Before we begin, make sure you have the following:

1. Basic knowledge of Solidity and smart contract development.
2. Node.js installed on your machine.
3. Familiarity with Hardhat. If you're new to Hardhat, you can refer to the [Hardhat documentation](https://hardhat.org/getting-started/) for installation and setup instructions.

# Overview of Celo Oracles

## What are Celo Oracles?

Celo oracles are specialized components that enable smart contracts to interact with external data. They act as bridges between the blockchain and off-chain data sources, fetching and verifying data to make it available within the Celo ecosystem.


## Why are Oracles Important?

Oracles play a crucial role in expanding the functionality and use cases of smart contracts. By providing access to external data, oracles enable smart contracts to interact with the real world and make decisions based on real-time information.

For example, in a decentralized finance (DeFi) application, an oracle can provide the current price of an asset. Smart contracts can then use this price to execute trades, calculate interest rates, or trigger other actions.

## Benefits and Challenges of Using Decentralized Oracles

Decentralized oracles offer several benefits compared to centralized alternatives:

- **Increased Security**: Decentralized oracles distribute the data-fetching and verification process across multiple nodes, making it more resistant to single points of failure and manipulation.

- **Transparency**: The operations performed by decentralized oracles are transparent and auditable on the blockchain, providing increased trust in the integrity of the data.

- **Trustless Data Feeds**: Decentralized oracles enable trustless data feeds, reducing the reliance on centralized entities for providing external data.

However, implementing decentralized oracles comes with challenges, such as ensuring data integrity, managing consensus mechanisms, and designing appropriate trust models.

## Setting up the Project

Let's start by setting up a new Hardhat project.

1. Create a new directory for your project:

   ```bash
   mkdir celo-oracles-tutorial
   cd celo-oracles-tutorial


2. Initialize a new Hardhat project:

```
npx hardhat init
```
3. Install the required dependencies:

```
npm install @celo/hardhat-celo hardhat dotenv
```

4. Create a new file named .env in the root directory of your project and add the following content:

```
MNEMONIC=<your-mnemonic-phrase>
```
Replace <your-mnemonic-phrase> with the mnemonic phrase of your Celo account. Make sure the account has some testnet CELO tokens for testing purposes.

## Configuring Hardhat
 Next, let's configure Hardhat to work with the Celo network and enable the required plugins.

1. Open the `hardhat.config.js` file generated by the  `npx hardhat init` command.

2. Replace the contents of the file with the following code:

```
   require('dotenv').config();

module.exports = {
  defaultNetwork: 'hardhat',
  networks: {
    hardhat: {},
    alfajores: {
      url: 'https://alfajores-forno.celo-testnet.org',
      accounts: { mnemonic: process.env.MNEMONIC },
    },
    mainnet: {
      url: 'https://forno.celo.org',
      accounts: { mnemonic: process.env.MNEMONIC },
    },
  },
  solidity: {
    version: '0.8.7',
    settings: {
      optimizer: {
        enabled: true,
        runs: 200,
      },
    },
  },
  paths: {
    sources: './contracts',
    tests: './test',
    cache: './cache',
    artifacts: './artifacts',
  },
  mocha: {
    timeout: 20000,
  },
};
```

This configuration sets up the networks for the Celo Alfajores testnet and the Celo mainnet. It also includes the necessary plugins and specifies the Solidity compiler version.

## Creating the Oracle Contract
Now, let's create a new Solidity contract that utilizes Celo oracles to fetch and store external data.

1. Create a new file named Oracle.sol in the contracts directory.

2. Add the following code to define the Oracle contract:

 ```
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import { UsingTellor } from "@chainlink/contracts/src/v0.8/dev/UsingTellor.sol";

contract Oracle is UsingTellor {
    uint256 public data;

    constructor(address _tellorAddress) UsingTellor(_tellorAddress) {}

    /**
     * @dev Fetches external data using the specified request ID.
     * @param _requestId The request ID of the data to fetch.
     */
    function fetchExternalData(uint256 _requestId) external {
        // Request data from the Tellor oracle with a 24-hour timeout and no tip
        requestData(_requestId, 86400, 0);
    }

    /**
     * @dev Callback function called by the Tellor oracle when data is fulfilled.
     * @param _requestId The request ID of the fulfilled data.
     * @param _data The fetched data value.
     */
    function fulfill(uint256 _requestId, uint256 _data) external override {
        // Ensure that only the Tellor contract can call this function
        require(msg.sender == address(tellor), "Caller is not the Tellor contract");

        // Store the fetched data in the contract
        data = _data;
    }
}

 ```
In this contract, we define the `data` variable to store the fetched external data. The `fetchExternalData` function is used to trigger the data retrieval process, and the `fulfill` function is a callback function called by the Tellor oracle when the data is fulfilled. It verifies the caller is the Tellor contract and stores the fetched data in the `data` variable.

## Writing Tests
Let's write some tests to ensure our contract functions as expected.

1. Create a new file named oracle.test.js in the test directory.

2. Add the following code to define the tests:

```
const { expect } = require('chai');
const { ethers } = require('hardhat');

describe('Oracle', function () {
  let oracle;

  beforeEach(async function () {
    const Oracle = await ethers.getContractFactory('Oracle');
    oracle = await Oracle.deploy('<tellor-contract-address>');
    await oracle.deployed();
  });

  it('should fetch external data', async function () {
    await oracle.fetchExternalData(1); // Replace 1 with the desired request ID
    const data = await oracle.data();
    expect(data).to.equal(0); // Replace 0 with the expected fetched data value
  });
});

```

In this test, we deploy the Oracle contract and verify that the fetchExternalData function correctly initializes the data variable. Adjust the request ID and expected data value according to your use case.

## Compiling and Running Tests

1. Compile the contracts and run the tests using Hardhat:

```
npx hardhat compile
npx hardhat test
```
If everything is set up correctly, you should see the test passing.

## Conclusion
Congratulations! You have learned how to implement Celo blockchain oracles for external data integration in your smart contracts and DApps. By leveraging Celo oracles, you can securely access off-chain data and enhance the functionality of your decentralized applications.

Remember to refer to the official Celo documentation and community resources to stay updated with the latest features and best practices.
   

